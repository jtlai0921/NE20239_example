<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>&#31532;&nbsp;9&nbsp;&#31456;&nbsp;&#25805;&#20316;&#25345;&#20037;&#21270;&#25968;&#25454;(Manipulating Persistent Data)</title><link rel="stylesheet" href="../shared/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;"><link rel="up" href="index.html" title="HIBERNATE - &#31526;&#21512;Java&#20064;&#24815;&#30340;&#20851;&#31995;&#25968;&#25454;&#24211;&#25345;&#20037;&#21270;"><link rel="previous" href="inheritance.html" title="&#31532;&nbsp;8&nbsp;&#31456;&nbsp;&#32487;&#25215;&#26144;&#23556;(Inheritance Mappings)"><link rel="next" href="transactions.html" title="&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#20107;&#21153;&#21644;&#24182;&#34892;&#65288;Transactions And Concurrency&#65289;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">&#31532;&nbsp;9&nbsp;&#31456;&nbsp;&#25805;&#20316;&#25345;&#20037;&#21270;&#25968;&#25454;(Manipulating Persistent Data)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="inheritance.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="transactions.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="chapter" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title"><a name="manipulatingdata"></a>&#31532;&nbsp;9&nbsp;&#31456;&nbsp;&#25805;&#20316;&#25345;&#20037;&#21270;&#25968;&#25454;(Manipulating Persistent Data)</h2></div></div><div></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-creating"></a>9.1.&nbsp;&#21019;&#24314;&#19968;&#20010;&#25345;&#20037;&#21270;&#23545;&#35937;</h2></div></div><div></div></div><p>
            &#23545;&#35937;&#65288;&#23454;&#20307;&#30340;&#23454;&#20363;&#65289;&#23545;&#19968;&#20010;&#29305;&#23450;&#30340;<tt class="literal">Session</tt>&#26469;&#35828;&#65292;&#35201;&#20040;&#26159;&#19968;&#20010;<span class="emphasis"><em>&#30636;&#26102;&#65288;transient&#65289;</em></span>&#23545;&#35937;&#65292;&#35201;&#20040;&#26159;<tt class="literal">&#25345;&#20037;&#21270;&#65288;persistent&#65289;</tt>&#23545;&#35937;&#12290;&#21018;&#21018;&#21019;&#24314;&#30340;&#23545;&#35937;&#24403;&#28982;&#26159;&#30636;&#26102;&#30340;(&#27880;&#65306;&#21518;&#25991;&#20013;transient object&#20063;&#31216;&#20026;&#20020;&#26102;&#23545;&#35937;)&#12290;session&#21017;&#25552;&#20379;&#20102;&#25226;&#30636;&#26102;&#23454;&#20363;&#20445;&#23384;&#65288;&#25345;&#20037;&#21270;&#65289;&#30340;&#26381;&#21153;:
        </p><pre class="programlisting">DomesticCat fritz = new DomesticCat();
fritz.setColor(Color.GINGER);
fritz.setSex('M');
fritz.setName("Fritz");
Long generatedId = (Long) sess.save(fritz);</pre><pre class="programlisting">DomesticCat pk = new DomesticCat();
pk.setColor(Color.TABBY);
pk.setSex('F');
pk.setName("PK");
pk.setKittens( new HashSet() );
pk.addKitten(fritz);
sess.save( pk, new Long(1234) );</pre><p>
            &#21333;&#21442;&#25968;&#30340;<tt class="literal">save()</tt>&#26041;&#27861;&#20026;<tt class="literal">fritz</tt>&#29983;&#25104;&#20102;&#19968;&#20010;&#24799;&#19968;&#26631;&#35782;&#31526;&#65292;&#24182;&#36171;&#32473;&#36825;&#20010;&#23545;&#35937;&#12290;&#21452;&#21442;&#25968;&#30340;&#24418;&#24335;&#21017;&#20351;&#29992;&#32473;&#23450;&#30340;&#26631;&#35782;&#31526;&#20445;&#23384;<tt class="literal">pk</tt>&#12290;&#25105;&#20204;&#19968;&#33324;&#19981;&#40723;&#21169;&#20351;&#29992;&#21452;&#21442;&#25968;&#30340;&#24418;&#24335;&#65292;&#22240;&#20026;&#36825;&#21487;&#33021;&#20250;&#65288;&#38544;&#21547;&#65289;&#20351;&#20027;&#38190;&#36171;&#20104;&#19994;&#21153;&#21547;&#20041;&#12290;&#23427;&#26377;&#29992;&#30340;&#26102;&#20505;&#26159;&#22312;&#19968;&#20123;&#29305;&#27530;&#22330;&#21512;&#19979;&#65292;&#27604;&#22914;&#20351;&#29992;Hibernate&#26469;&#25345;&#20037;&#21270;&#19968;&#20010;BMP&#23454;&#20307;bean.
        </p><p>
            &#20851;&#32852;&#30340;&#23545;&#35937;&#21487;&#20197;&#29992;&#20320;&#21916;&#27426;&#30340;&#20219;&#20309;&#39034;&#24207;&#25345;&#20037;&#21270;&#65292;&#38500;&#38750;&#26377;&#22806;&#38190;&#23383;&#27573;&#20855;&#26377;<tt class="literal">NOT NULL</tt>&#30340;&#32422;&#26463;&#12290;&#20915;&#19981;&#20250;&#26377;&#22806;&#38190;&#32422;&#26463;&#20914;&#31361;&#30340;&#21361;&#38505;&#12290;&#28982;&#32780;&#65292;&#22914;&#26524;&#22312;<tt class="literal">save()</tt>&#23545;&#35937;&#30340;&#26102;&#20505;&#29992;&#38169;&#20102;&#39034;&#24207;&#65292;&#20250;&#35302;&#29359;<tt class="literal">NOT NULL</tt>&#32422;&#26463;&#12290;
        </p></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-loading"></a>9.2.&nbsp;&#35013;&#36733;&#23545;&#35937;</h2></div></div><div></div></div><p>
            &#22914;&#26524;&#20320;&#24050;&#30693;&#26576;&#20010;&#25345;&#20037;&#21270;&#23454;&#20363;&#30340;&#26631;&#35782;&#31526;&#65292;<tt class="literal">Session</tt>&#30340;<tt class="literal">load()</tt>&#26041;&#27861;&#35753;&#20320;&#21462;&#20986;&#23427;&#12290;&#31532;&#19968;&#31181;&#24418;&#24335;&#20351;&#29992;&#19968;&#20010;&#31867;&#23545;&#35937;&#20316;&#20026;&#21442;&#25968;&#65292;&#20250;&#25226;&#29366;&#24577;&#35013;&#36733;&#21040;&#21478;&#19968;&#20010;&#26032;&#21019;&#24314;&#30340;&#23545;&#35937;&#20013;&#21435;&#12290;&#31532;&#20108;&#20010;&#29256;&#26412;&#20801;&#35768;&#20320;&#32473;&#20986;&#19968;&#20010;&#23454;&#20363;&#65292;&#20250;&#22312;&#20854;&#20013;&#35013;&#36733;&#29366;&#24577;&#12290;&#25226;&#23454;&#20363;&#20316;&#20026;&#21442;&#25968;&#30340;&#24418;&#24335;&#22312;&#20320;&#20934;&#22791;&#25226;Hibernate&#21644;BMP&#23454;&#20307;bean&#19968;&#36215;&#20351;&#29992;&#30340;&#26102;&#20505;&#29305;&#21035;&#26377;&#29992;&#65292;&#23427;&#23601;&#26159;&#20026;&#27492;&#35774;&#35745;&#30340;&#12290;&#20320;&#20063;&#21487;&#20197;&#21457;&#29616;&#20854;&#20182;&#30340;&#29992;&#36884;&#65288;&#27604;&#22914;&#33258;&#24049;&#23454;&#29616;&#23454;&#20363;&#27744;&#31561;&#31561;&#65289;&#12290;
        </p><pre class="programlisting">Cat fritz = (Cat) sess.load(Cat.class, generatedId);</pre><pre class="programlisting">// you need to wrap primitive identifiers
long pkId = 1234;
DomesticCat pk = (DomesticCat) sess.load( Cat.class, new Long(pkId) );</pre><pre class="programlisting">Cat cat = new DomesticCat();
// load pk''s state into cat
sess.load( cat, new Long(pkId) );
Set kittens = cat.getKittens();</pre><p>
            &#35831;&#27880;&#24847;&#22914;&#26524;&#27809;&#26377;&#21305;&#37197;&#30340;&#25968;&#25454;&#24211;&#35760;&#24405;&#65292;<tt class="literal">load()</tt>&#26041;&#27861;&#21487;&#33021;&#25243;&#20986;&#26080;&#27861;&#24674;&#22797;&#30340;exception&#12290;&#22914;&#26524;&#31867;&#26159;&#36890;&#36807;&#20195;&#29702;&#26144;&#23556;&#30340;&#65292;<tt class="literal">load()</tt>&#26041;&#27861;&#36820;&#22238;&#19968;&#20010;&#23545;&#35937;&#65292;&#36825;&#26159;&#19968;&#20010;&#26410;&#21021;&#22987;&#21270;&#30340;&#20195;&#29702;&#65292;&#24182;&#19988;&#30452;&#21040;&#20320;&#35843;&#29992;&#35813;&#23545;&#35937;&#30340;&#26576;&#26041;&#27861;&#26102;&#25165;&#20250;&#21435;&#35775;&#38382;&#25968;&#25454;&#24211;&#12290;&#36825;&#31181;&#34892;&#20026;&#26041;&#24335;&#22312;&#20320;&#21916;&#27426;&#21019;&#24314;&#19968;&#20010;&#25351;&#21521;&#26576;&#23545;&#35937;&#30340;&#20851;&#32852;&#65292;&#21448;&#19981;&#24819;&#30495;&#30340;&#20174;&#25968;&#25454;&#24211;&#20013;&#35013;&#36733;&#23427;&#30340;&#26102;&#20505;&#29305;&#21035;&#26377;&#29992;&#12290;
        </p><p>
            &#22914;&#26524;&#20320;&#19981;&#30830;&#23450;&#26159;&#21542;&#26377;&#21305;&#37197;&#30340;&#34892;&#23384;&#22312;&#65292;&#20320;&#24212;&#35813;&#20351;&#29992;<tt class="literal">get()</tt>&#26041;&#27861;&#65292;&#23427;&#20250;&#31435;&#21051;&#35775;&#38382;&#25968;&#25454;&#24211;&#65292;&#22914;&#26524;&#27809;&#26377;&#23545;&#24212;&#30340;&#34892;&#65292;&#36820;&#22238;null&#12290;
        </p><pre class="programlisting">Cat cat = (Cat) sess.get(Cat.class, id);
if (cat==null) {
    cat = new Cat();
    sess.save(cat, id);
}
return cat;</pre><p>
            &#20320;&#21487;&#20197;&#29992;SQL<tt class="literal">SELECT ... FOR UPDATE</tt>&#35013;&#36733;&#23545;&#35937;&#12290;&#19979;&#19968;&#33410;&#26377;&#20851;&#20110;Hibernate <tt class="literal">LockMode</tt>&#30340;&#35752;&#35770;&#12290;
        </p><pre class="programlisting">Cat cat = (Cat) sess.get(Cat.class, id, LockMode.UPGRADE);</pre><p>
            &#27880;&#24847;&#65292;&#20219;&#20309;&#20851;&#32852;&#30340;&#23454;&#20363;&#25110;&#32773;&#21253;&#21547;&#30340;&#38598;&#21512;&#37117;<span class="emphasis"><em>&#19981;&#20250;</em></span>&#34987;&#20570;&#20026;<tt class="literal">FOR UPDATE</tt>&#36820;&#22238;&#12290;
        </p><p>
            &#20219;&#20309;&#26102;&#20505;&#37117;&#21487;&#20197;&#20351;&#29992;<tt class="literal">refresh()</tt>&#26041;&#27861;&#37325;&#26032;&#35013;&#36733;&#23545;&#35937;&#21644;&#23427;&#30340;&#38598;&#21512;&#12290;&#22914;&#26524;&#20320;&#20351;&#29992;&#25968;&#25454;&#24211;&#35302;&#21457;&#22120;&#26356;&#25913;&#20102;&#23545;&#35937;&#30340;&#26576;&#20123;&#23646;&#24615;&#65292;&#36825;&#23601;&#24456;&#26377;&#29992;&#12290;
        </p><pre class="programlisting">sess.save(cat);
sess.flush(); //force the SQL INSERT
sess.refresh(cat); //re-read the state (after the trigger executes)</pre></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-querying"></a>9.3.&nbsp;Querying</h2></div></div><div></div></div><p>
            &#22914;&#26524;&#20320;&#19981;&#33021;&#30830;&#23450;&#20320;&#35201;&#23547;&#25214;&#30340;&#23545;&#35937;&#30340;&#26631;&#31034;&#31526;&#65292;&#35831;&#20351;&#29992;<tt class="literal">Session</tt>&#30340;<tt class="literal">find()</tt>&#26041;&#27861;&#12290;Hibernate&#20351;&#29992;&#19968;&#31181;&#31616;&#21333;&#32780;&#24378;&#22823;&#30340;&#38754;&#21521;&#23545;&#35937;&#26597;&#35810;&#35821;&#35328;&#12290;
        </p><pre class="programlisting">List cats = sess.find(
    "from Cat as cat where cat.birthdate = ?",
    date,
    Hibernate.DATE
);

List mates = sess.find(
    "select mate from Cat as cat join cat.mate as mate " +
    "where cat.name = ?",
    name,
    Hibernate.STRING
);

List cats = sess.find( "from Cat as cat where cat.mate.bithdate is null" );

List moreCats = sess.find(
    "from Cat as cat where " + 
    "cat.name = 'Fritz' or cat.id = ? or cat.id = ?",
    new Object[] { id1, id2 },
    new Type[] { Hibernate.LONG, Hibernate.LONG }
);

List mates = sess.find(
    "from Cat as cat where cat.mate = ?",
    izi,
    Hibernate.entity(Cat.class)
);

List problems = sess.find(
    "from GoldFish as fish " +
    "where fish.birthday &gt; fish.deceased or fish.birthday is null"
);</pre><p>
           	<tt class="literal">find()</tt>&#30340;&#31532;&#20108;&#20010;&#21442;&#25968;&#25509;&#21463;&#19968;&#20010;&#23545;&#35937;&#25110;&#32773;&#23545;&#35937;&#25968;&#32452;&#12290;&#31532;&#19977;&#20010;&#21442;&#25968;&#25509;&#21463;&#19968;&#20010;Hibernate&#31867;&#22411;&#25110;&#32773;&#31867;&#22411;&#30340;&#25968;&#32452;&#12290;&#36825;&#20123;&#25351;&#23450;&#30340;&#31867;&#22411;&#29992;&#26469;&#25226;&#32473;&#23450;&#30340;&#23545;&#35937;&#32465;&#23450;&#21040;&#26597;&#35810;&#20013;&#30340;<tt class="literal">?</tt>&#21344;&#20301;&#31526;&#65288;&#23454;&#38469;&#19978;&#23545;&#24212;&#30340;&#26159;JDBC <tt class="literal">PreparedStatement</tt>&#30340;&#20256;&#20837;&#21442;&#25968;&#65289;&#12290;&#23601;&#20687;&#22312;JDBC&#20013;&#19968;&#30524;&#65292;&#20320;&#24212;&#35813;&#20248;&#20808;&#20351;&#29992;&#36825;&#31181;&#21442;&#25968;&#32465;&#23450;&#30340;&#26041;&#24335;&#65292;&#32780;&#38750;&#32452;&#35013;&#23383;&#31526;&#20018;&#12290;
        </p><p>
            <tt class="literal">Hibernate</tt>&#31867;&#23450;&#20041;&#20102;&#19968;&#20123;&#38745;&#24577;&#26041;&#27861;&#21644;&#24120;&#37327;&#65292;&#25552;&#20379;&#20102;&#35775;&#38382;&#22823;&#37096;&#20998;&#20869;&#32622;&#31867;&#22411;&#30340;&#25163;&#27573;&#12290;&#36825;&#20123;&#20869;&#32622;&#31867;&#22411;&#26159;<tt class="literal">net.sf.hibernate.type.Type</tt>&#30340;&#23454;&#20363;&#12290;
        </p><p>
            &#22914;&#26524;&#20320;&#30693;&#36947;&#20320;&#30340;&#26597;&#35810;&#20250;&#36820;&#22238;&#38750;&#24120;&#22823;&#37327;&#30340;&#23545;&#35937;&#65292;&#20294;&#26159;&#20320;&#19981;&#24076;&#26395;&#20840;&#37096;&#20351;&#29992;&#23427;&#20204;&#65292;&#20320;&#21487;&#20197;&#29992;<tt class="literal">iterate()</tt>&#26041;&#27861;&#33719;&#24471;&#26356;&#22909;&#30340;&#24615;&#33021;&#65292;&#23427;&#20250;&#36820;&#22238;&#19968;&#20010;<tt class="literal">java.util.Iterator</tt>&#12290;&#36825;&#20010;&#36845;&#20195;&#22120;&#20250;&#22312;&#38656;&#35201;&#30340;&#26102;&#20505;&#35013;&#36733;&#23545;&#35937;&#65292;&#25152;&#20351;&#29992;&#30340;&#26631;&#35782;&#31526;&#26469;&#33258;&#19968;&#20010;&#21069;&#23548;&#30340;SQL&#26597;&#35810;&#12290;(&#19968;&#20849;&#26159;N+1&#27425;&#26597;&#35810;&#65289;
        </p><pre class="programlisting">// fetch ids
Iterator iter = sess.iterate("from eg.Qux q order by q.likeliness"); 
while ( iter.hasNext() ) {
    Qux qux = (Qux) iter.next();  // fetch the object
    // something we couldnt express in the query
    if ( qux.calculateComplicatedAlgorithm() ) {
        // delete the current instance
        iter.remove();
        // dont need to process the rest
        break;
    }
}</pre><p>
        	&#24456;&#19981;&#24184;&#65292;<tt class="literal">java.util.Iterator</tt>&#27809;&#26377;&#22768;&#26126;&#20219;&#20309;exception&#12290;&#25152;&#20197;&#65292;&#21457;&#29983;&#30340;&#20219;&#20309;SQL&#25110;&#32773;Hibernate&#30340;exception&#37117;&#20250;&#34987;&#21253;&#35013;&#22312;&#19968;&#20010;<tt class="literal">LazyInitializationException</tt>&#20013;&#65288;&#23427;&#26159;<tt class="literal">RuntimeException</tt>&#30340;&#23376;&#31867;&#65289;&#12290;
        </p><p>
            &#22914;&#26524;&#20320;&#39044;&#26399;&#22823;&#37096;&#20998;&#30340;&#23545;&#35937;&#24050;&#32463;&#35013;&#36733;&#36807;&#65292;&#23384;&#22312;&#20110;session&#30340;&#32531;&#23384;&#20013;&#20102;&#65292;&#25110;&#32773;&#26597;&#35810;&#32467;&#26524;&#21253;&#21547;&#21516;&#26679;&#30340;&#23545;&#35937;&#24456;&#22810;&#27425;&#65292;&#37027;&#20040;<tt class="literal">iterator()</tt>&#26041;&#27861;&#20063;&#20250;&#33719;&#24471;&#26356;&#22909;&#30340;&#24615;&#33021;&#12290;&#65288;&#22914;&#26524;&#27809;&#26377;&#20219;&#20309;&#25968;&#25454;&#34987;&#32531;&#23384;&#25110;&#32773;&#37325;&#22797;&#20986;&#29616;&#65292;&#21017;<tt class="literal">find()</tt>&#24635;&#26159;&#20250;&#26356;&#24555;&#12290;&#65289;&#19979;&#38754;&#26159;&#19968;&#20010;&#24212;&#35813;&#20351;&#29992;<tt class="literal">iterator()</tt>&#35843;&#29992;&#30340;&#26597;&#35810;&#20363;&#23376;&#65306;
        </p><pre class="programlisting">
Iterator iter = sess.iterate(
    "select customer, product " + 
    "from Customer customer, " +
    "Product product " +
    "join customer.purchases purchase " +
    "where product = purchase.product"
);</pre><p>
            &#22914;&#26524;&#23545;&#19978;&#38754;&#30340;&#26597;&#35810;&#20351;&#29992;<tt class="literal">find()</tt>&#65292;&#20250;&#36820;&#22238;&#19968;&#20010;&#38750;&#24120;&#22823;&#30340;JDBC<tt class="literal">ResultSet</tt>,&#21253;&#21547;&#24456;&#22810;&#37325;&#22797;&#30340;&#30456;&#21516;&#25968;&#25454;&#12290;
        </p><p>
            &#26377;&#26102;&#20505;Hibernate&#26597;&#35810;&#20250;&#27599;&#34892;&#36820;&#22238;&#22810;&#31181;&#23545;&#35937;&#65292;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#27599;&#34892;&#20250;&#36820;&#22238;&#19968;&#20010;&#25968;&#32452;&#65292;&#21253;&#21547;&#22810;&#20010;&#23545;&#35937;&#20803;&#32032;&#65306;
        </p><pre class="programlisting">Iterator foosAndBars = sess.iterate(
    "select foo, bar from Foo foo, Bar bar " +
    "where bar.date = foo.date"
);
while ( foosAndBars.hasNext() ) {
    Object[] tuple = (Object[]) foosAndBars.next();
    Foo foo = tuple[0]; Bar bar = tuple[1];
    ....
}</pre><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-scalarqueries"></a>9.3.1.&nbsp;&#26631;&#37327;&#26597;&#35810;&#65288;Scalar query&#65289;</h3></div></div><div></div></div><p>
            &#26597;&#35810;&#21487;&#20197;&#22312;<tt class="literal">select</tt>&#23376;&#21477;&#20013;&#25351;&#23450;&#31867;&#30340;&#23646;&#24615;&#12290;&#29978;&#33267;&#21487;&#20197;&#35843;&#29992;SQL&#30340;&#32479;&#35745;&#20989;&#25968;&#12290;&#23646;&#24615;&#25110;&#32773;&#32479;&#35745;&#20540;&#34987;&#31216;&#20026;&#8220;&#26631;&#37327;(scalar)&#8221;&#32467;&#26524;&#12290;
        </p><pre class="programlisting">Iterator results = sess.iterate(
        "select cat.color, min(cat.birthdate), count(cat) from Cat cat " +
        "group by cat.color"
);
while ( results.hasNext() ) {
    Object[] row = results.next();
    Color type = (Color) row[0];
    Date oldest = (Date) row[1];
    Integer count = (Integer) row[2];
    .....
}</pre><pre class="programlisting">Iterator iter = sess.iterate(
    "select cat.type, cat.birthdate, cat.name from DomesticCat cat"
);</pre><pre class="programlisting">List list = sess.find(
    "select cat, cat.mate.name from DomesticCat cat"
);</pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-queryinterface"></a>9.3.2.&nbsp;&#26597;&#35810;&#25509;&#21475;&#65288;Query interface&#65289;</h3></div></div><div></div></div><p>
            &#22914;&#26524;&#20320;&#38656;&#35201;&#20026;&#20320;&#30340;&#32467;&#26524;&#38598;&#35774;&#32622;&#36793;&#30028;&#65288;&#20320;&#38656;&#35201;&#33719;&#21462;&#30340;&#26368;&#22823;&#34892;&#25968;&#19982;/&#25110;&#20320;&#24076;&#26395;&#33719;&#21462;&#30340;&#31532;&#19968;&#34892;&#65289;&#65292;&#20320;&#24212;&#35813;&#24471;&#21040;&#19968;&#20010;<tt class="literal">net.sf.hibernate.Query</tt>&#30340;&#23454;&#20363;&#65306;
        </p><pre class="programlisting">Query q = sess.createQuery("from DomesticCat cat");
q.setFirstResult(20);
q.setMaxResults(10);
List cats = q.list();</pre><p>
            &#20320;&#29978;&#33267;&#21487;&#20197;&#22312;&#26144;&#23556;&#25991;&#26723;&#20013;&#23450;&#20041;&#21629;&#21517;&#26597;&#35810;&#12290;&#65288;&#35760;&#24471;&#29992;&#19968;&#20010;<tt class="literal">CDATA</tt>&#22359;&#25226;&#20320;&#30340;&#26597;&#35810;&#21253;&#21547;&#36215;&#26469;&#65292;&#21542;&#21017;&#22312;&#20998;&#26512;&#30340;&#26102;&#20505;&#21487;&#33021;&#24341;&#36215;&#35823;&#35299;&#12290;&#65289;
        </p><pre class="programlisting">&lt;query name="eg.DomesticCat.by.name.and.minimum.weight"&gt;&lt;![CDATA[
    from eg.DomesticCat as cat
        where cat.name = ?
        and cat.weight &gt; ?
] ]&gt;&lt;/query&gt;</pre><pre class="programlisting">Query q = sess.getNamedQuery("eg.DomesticCat.by.name.and.minimum.weight");
q.setString(0, name);
q.setInt(1, minWeight);
List cats = q.list();</pre><p>
            &#26597;&#35810;&#30028;&#38754;&#25903;&#25345;&#20351;&#29992;&#21629;&#21517;&#21442;&#25968;&#12290;&#21629;&#21517;&#21442;&#25968;&#29992;<tt class="literal">:name</tt>&#30340;&#24418;&#24335;&#22312;&#26597;&#35810;&#23383;&#31526;&#20018;&#20013;&#34920;&#31034;&#12290;&#22312;<tt class="literal">Query</tt>&#20013;&#26377;&#26041;&#27861;&#25226;&#23454;&#38469;&#21442;&#25968;&#32465;&#23450;&#21040;&#21629;&#21517;&#21442;&#25968;&#25110;&#32773;JDBC&#39118;&#26684;&#30340;<tt class="literal">?</tt>&#21442;&#25968;&#12290;<span class="emphasis"><em>
&#21644;JDBC&#19981;&#21516;&#65292;Hibernate&#30340;&#21442;&#25968;&#20174;0&#24320;&#22987;&#35745;&#25968;&#12290;</em></span> &#20351;&#29992;&#21629;&#21517;&#21442;&#25968;&#26377;&#19968;&#20123;&#22909;&#22788;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#21629;&#21517;&#21442;&#25968;&#19981;&#20381;&#36182;&#20110;&#23427;&#20204;&#22312;&#26597;&#35810;&#23383;&#31526;&#20018;&#20013;&#20986;&#29616;&#30340;&#39034;&#24207;
                </p></li><li><p>
                    &#22312;&#21516;&#19968;&#20010;&#26597;&#35810;&#20013;&#21487;&#20197;&#20351;&#29992;&#22810;&#27425;
                </p></li><li><p>
                    &#20182;&#20204;&#21487;&#35835;&#24615;&#22909;
                </p></li></ul></div><pre class="programlisting">//named parameter (preferred)
Query q = sess.createQuery("from DomesticCat cat where cat.name = :name");
q.setString("name", "Fritz");
Iterator cats = q.iterate();</pre><pre class="programlisting">//positional parameter
Query q = sess.createQuery("from DomesticCat cat where cat.name = ?");
q.setString(0, "Izi");
Iterator cats = q.iterate();</pre><pre class="programlisting">//named parameter list
List names = new ArrayList();
names.add("Izi");
names.add("Fritz");
Query q = sess.createQuery("from DomesticCat cat where cat.name in (:namesList)");
q.setParameterList("namesList", names);
List cats = q.list();</pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-scrolling"></a>9.3.3.&nbsp;&#21487;&#28378;&#21160;&#36845;&#20195;(Scrollable iteration)</h3></div></div><div></div></div><p>
            &#22914;&#26524;&#20320;&#30340;JDBC&#39537;&#21160;&#25903;&#25345;&#21487;&#28378;&#21160;&#30340;<tt class="literal">ResuleSet</tt>,<tt class="literal">Query</tt>&#25509;&#21475;&#21487;&#20197;&#33719;&#21462;&#19968;&#20010;<tt class="literal">ScrollableResults</tt>&#65292;&#20801;&#35768;&#20320;&#22312;&#26597;&#35810;&#32467;&#26524;&#20013;&#28789;&#27963;&#28216;&#36208;&#12290;
        </p><pre class="programlisting">Query q = sess.createQuery("select cat.name, cat from DomesticCat cat " +
                            "order by cat.name");
ScrollableResults cats = q.scroll();
if ( cats.first() ) {

    // find the first name on each page of an alphabetical list of cats by name
    firstNamesOfPages = new ArrayList();
    do {
        String name = cats.getString(0);
        firstNamesOfPages.add(name);
    }
    while ( cats.scroll(PAGE_SIZE) );

    // Now get the first page of cats
    pageOfCats = new ArrayList();
    cats.beforeFirst();
    int i=0;
    while( ( PAGE_SIZE &gt; i++ ) &amp;&amp; cats.next() ) pageOfCats.add( cats.get(1) );

}</pre><p>
        <tt class="literal">scroll()</tt>&#30340;&#34892;&#20026;&#26041;&#24335;&#19982;<tt class="literal">iterate()</tt>&#24456;&#31867;&#20284;&#65292;&#38500;&#20102;&#23545;&#35937;&#21487;&#20197;&#26377;&#36873;&#25321;&#30340;&#29992;<tt class="literal">get(int)</tt>&#21021;&#22987;&#21270;&#65292;&#32780;&#38750;&#25972;&#20010;&#34892;&#37117;&#19968;&#27425;&#24615;&#34987;&#21021;&#22987;&#21270;&#12290;
    </p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-filtering"></a>9.3.4.&nbsp;&#36807;&#28388;&#38598;&#21512;&#31867;(Filtering collections)</h3></div></div><div></div></div><p>
            &#38598;&#21512;<span class="emphasis"><em>filter</em></span>&#26159;&#19968;&#31181;&#29305;&#27530;&#30340;&#26597;&#35810;&#65292;&#29992;&#20110;&#19968;&#20010;&#25345;&#20037;&#21270;&#38598;&#21512;&#25110;&#32773;&#25968;&#32452;&#12290;&#26597;&#35810;&#23383;&#31526;&#20018;&#21487;&#20197;&#24341;&#29992;<tt class="literal">this</tt>,&#24847;&#20026;&#24403;&#21069;&#30340;&#25968;&#32452;&#20803;&#32032;&#12290;
        </p><pre class="programlisting">Collection blackKittens = session.filter( 
    pk.getKittens(), "where this.color = ?", Color.BLACK, Hibernate.enum(Color.class)
);</pre><p>
            &#36820;&#22238;&#30340;&#38598;&#21512;&#34987;&#35748;&#20026;&#26159;&#19968;&#20010;&#21253;(bag)&#12290;
        </p><p>
            &#35831;&#27880;&#24847;filter&#24182;&#19981;&#38656;&#35201;<tt class="literal">from</tt> &#23376;&#21477;&#65288;&#24403;&#28982;&#38656;&#35201;&#30340;&#35805;&#23427;&#20204;&#20063;&#21487;&#20197;&#21152;&#19978;&#65289;&#12290;Filter&#19981;&#38480;&#23450;&#36820;&#22238;&#23427;&#20204;&#33258;&#24049;&#30340;&#38598;&#21512;&#20803;&#32032;&#12290;
        </p><pre class="programlisting">Collection blackKittenMates = session.filter( 
    pk.getKittens(), "select this.mate where this.color = eg.Color.BLACK"
);</pre></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-criteria"></a>9.3.5.&nbsp;&#26465;&#20214;&#26597;&#35810;</h3></div></div><div></div></div><p>
            HQL&#26497;&#20026;&#24378;&#22823;&#65292;&#20294;&#26159;&#26377;&#20123;&#20154;&#24076;&#26395;&#33021;&#22815;&#21160;&#24577;&#30340;&#20351;&#29992;&#19968;&#31181;&#38754;&#21521;&#23545;&#35937;API&#21019;&#24314;&#26597;&#35810;&#65292;&#32780;&#38750;&#22312;&#20182;&#20204;&#30340;Java&#20195;&#30721;&#20013;&#23884;&#20837;&#23383;&#31526;&#20018;&#12290;&#23545;&#20110;&#37027;&#37096;&#20998;&#20154;&#26469;&#35828;&#65292;Hibernate&#25552;&#20379;&#20102;&#19968;&#31181;&#30452;&#35266;&#30340;<tt class="literal">Criteria</tt>&#26597;&#35810;API&#12290;
        </p><pre class="programlisting">Criteria crit = session.createCriteria(Cat.class);
crit.add( Expression.eq("color", eg.Color.BLACK) );
crit.setMaxResults(10);
List cats = crit.list();</pre><p>
            &#22914;&#26524;&#20320;&#23545;&#31867;&#20284;&#20110;SQL&#30340;&#35821;&#27861;&#19981;&#26159;&#24863;&#35273;&#24456;&#33298;&#26381;&#30340;&#35805;&#65292;&#29992;&#36825;&#31181;&#26041;&#27861;&#24320;&#22987;&#20351;&#29992;Hibernate&#21487;&#33021;&#26356;&#23481;&#26131;&#12290;&#36825;&#31181;API&#20063;&#27604;HQL&#26356;&#21487;&#25193;&#23637;&#12290;&#31243;&#24207;&#21487;&#20197;&#25552;&#20379;&#23427;&#20204;&#33258;&#24049;&#30340;<tt class="literal">Criterion</tt>&#25509;&#21475;&#30340;&#23454;&#29616;&#12290;
        </p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-nativesql"></a>9.3.6.&nbsp;&#20351;&#29992;&#26412;&#22320;SQL&#30340;&#26597;&#35810;</h3></div></div><div></div></div><p>
            &#20320;&#21487;&#20197;&#20351;&#29992;<tt class="literal">createSQLQuery()</tt>&#26041;&#27861;&#65292;&#29992;SQL&#26469;&#34920;&#36798;&#26597;&#35810;&#12290;&#20320;&#24517;&#39035;&#25226;SQL&#21035;&#21517;&#29992;&#22823;&#25324;&#21495;&#21253;&#22260;&#36215;&#26469;&#12290;
        </p><pre class="programlisting">List cats = session.createSQLQuery(
    "SELECT {cat.*} FROM CAT {cat} WHERE ROWNUM&lt;10",
    "cat",
    Cat.class
).list();</pre><pre class="programlisting">List cats = session.createSQLQuery(
    "SELECT {cat}.ID AS {cat.id}, {cat}.SEX AS {cat.sex}, " +
           "{cat}.MATE AS {cat.mate}, {cat}.SUBCLASS AS {cat.class}, ... " +
    "FROM CAT {cat} WHERE ROWNUM&lt;10",
    "cat",
    Cat.class
).list()</pre><p>
            &#21644;Hibernate&#26597;&#35810;&#19968;&#26679;&#65292;SQL&#26597;&#35810;&#20063;&#21487;&#20197;&#21253;&#21547;&#21629;&#21517;&#21442;&#25968;&#25110;&#32773;&#39034;&#24207;&#21442;&#25968;&#12290;
        </p></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-updating"></a>9.4.&nbsp;&#26356;&#26032;&#23545;&#35937;</h2></div></div><div></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-updating-insession"></a>9.4.1.&nbsp;&#22312;&#21516;&#19968;Session&#20013;&#26356;&#26032;</h3></div></div><div></div></div><p>
            <span class="emphasis"><em>&#20107;&#21153;&#20013;&#30340;&#25345;&#20037;&#21270;&#23454;&#20363;</em></span>&#65288;&#23601;&#26159;&#36890;&#36807;<tt class="literal">session</tt>&#35013;&#36733;&#12289;&#20445;&#23384;&#12289;&#21019;&#24314;&#25110;&#32773;&#26597;&#35810;&#20986;&#30340;&#23545;&#35937;&#65289;&#21487;&#20197;&#34987;&#31243;&#24207;&#25805;&#20316;&#65292;&#25152;&#20570;&#30340;&#20219;&#20309;&#20462;&#25913;&#37117;&#20250;&#22312;<tt class="literal">Session</tt><span class="emphasis"><em>&#21516;&#27493;&#65288;flushed&#65289;</em></span>&#30340;&#26102;&#20505;&#34987;&#25345;&#20037;&#21270;&#65288;&#26412;&#31456;&#21518;&#38754;&#20250;&#35814;&#32454;&#35752;&#35770;&#65289;&#12290;&#25152;&#20197;&#26368;&#30452;&#25509;&#30340;&#26356;&#25913;&#19968;&#20010;&#23545;&#35937;&#30340;&#26041;&#27861;&#23601;&#26159;<tt class="literal">load()</tt>&#23427;&#65292;&#20445;&#25345;<tt class="literal">Session</tt>&#25171;&#24320;&#65292;&#28982;&#21518;&#30452;&#25509;&#20462;&#25913;&#21363;&#21487;&#65306;
        </p><pre class="programlisting">DomesticCat cat = (DomesticCat) sess.load( Cat.class, new Long(69) );
cat.setName("PK");
sess.flush();  // changes to cat are automatically detected and persisted</pre><p>
            &#26377;&#20123;&#26102;&#20505;&#36825;&#31181;&#32534;&#31243;&#27169;&#24335;&#26174;&#24471;&#25928;&#29575;&#19981;&#39640;&#65292;&#22240;&#20026;&#23427;&#38656;&#35201;&#22312;&#21516;&#19968;&#20010;session&#20013;&#20808;&#20351;&#29992;SQL <tt class="literal">SELECT</tt>(&#26469;&#35013;&#36733;&#23545;&#35937;),&#21448;&#26377;&#19968;&#20010;SQL <tt class="literal">UPDATE</tt>&#65288;&#26469;&#25226;&#20462;&#25913;&#30340;&#29366;&#24577;&#20889;&#22238;&#65289;&#12290;&#22240;&#27492;&#65292;Hibernate&#25552;&#20379;&#20102;&#21478;&#19968;&#31181;&#26041;&#24335;&#12290;
        </p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-updating-detached"></a>9.4.2.&nbsp;&#26356;&#26032;&#20174;session&#33073;&#31163;&#30340;&#23545;&#35937;</h3></div></div><div></div></div><p>
            &#24456;&#22810;&#31243;&#24207;&#38656;&#35201;&#22312;&#19968;&#20010;&#20107;&#21153;&#20013;&#33719;&#21462;&#23545;&#35937;&#65292;&#28982;&#21518;&#21457;&#36865;&#21040;&#30028;&#38754;&#23618;&#21435;&#25805;&#20316;&#65292;&#29992;&#19968;&#20010;&#26032;&#30340;&#20107;&#21153;&#26469;&#20445;&#23384;&#20462;&#25913;&#12290;&#65288;&#22312;&#39640;&#21516;&#27493;&#35775;&#38382;&#30340;&#29615;&#22659;&#20013;&#20351;&#29992;&#36825;&#31181;&#26041;&#24335;&#65292;&#32463;&#24120;&#20351;&#29992;&#38468;&#24102;&#29256;&#26412;&#30340;&#25968;&#25454;&#26469;&#20445;&#35777;&#20107;&#21153;&#29420;&#31435;&#24615;&#12290;&#65289;&#36825;&#31181;&#26041;&#27861;&#38656;&#35201;&#21644;&#19978;&#19968;&#33410;&#25152;&#25551;&#36848;&#30340;&#30053;&#24494;&#19981;&#21516;&#30340;&#32534;&#31243;&#27169;&#22411;&#12290;Hibernate&#25903;&#25345;&#36825;&#31181;&#27169;&#22411;&#65292;&#22240;&#20026;&#23427;&#25552;&#20379;&#20102;<tt class="literal">Session.update()</tt>&#26041;&#27861;&#12290;
        </p><pre class="programlisting">// in the first session
Cat cat = (Cat) firstSession.load(Cat.class, catId);
Cat potentialMate = new Cat();
firstSession.save(potentialMate);

// in a higher tier of the application
cat.setMate(potentialMate);

// later, in a new session
secondSession.update(cat);  // update cat
secondSession.update(mate); // update mate</pre><p>
            &#22914;&#26524;&#25317;&#26377;<tt class="literal">catId</tt>&#26631;&#35782;&#31526;&#30340;<tt class="literal">Cat</tt>&#22312;&#35797;&#22270;update&#23427;&#20043;&#21069;&#24050;&#32463;&#34987;<tt class="literal">secondSession</tt>&#35013;&#36733;&#20102;&#65292;&#20250;&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;&#12290;
        </p><p>
            &#23545;&#20110;&#32473;&#23450;&#30340;&#20020;&#26102;&#23454;&#20363;&#65292;<span class="emphasis"><em>&#24403;&#19988;&#20165;&#24403;</em></span> &#23427;&#20204;&#35302;&#21450;&#30340;&#20854;&#20182;&#20020;&#26102;&#23454;&#20363;&#38656;&#35201;&#20445;&#23384;&#30340;&#26102;&#20505;&#65292;
            &#24212;&#29992;&#31243;&#24207;&#24212;&#35813;&#23545;&#23427;&#20204;&#20998;&#21035;&#21508;&#33258;&#20351;&#29992;<tt class="literal">update()</tt>&#12290;&#65288;&#33258;&#21160;&#31649;&#29702;&#29983;&#21629;&#21608;&#26399;&#30340;&#23545;&#35937;(lifecycle object)&#38500;&#22806;&#65292;&#21518;&#38754;&#20250;&#35752;&#35770;&#21040;&#12290;&#65289;
        </p><p>
            Hibernate&#29992;&#25143;&#26366;&#32463;&#35201;&#27714;&#26377;&#19968;&#20010;&#36890;&#29992;&#30340;&#26041;&#27861;&#65292;&#21487;&#20197;&#20026;&#26032;&#24314;&#30340;&#20020;&#26102;&#23454;&#20363;&#29983;&#25104;&#26631;&#35782;&#31526;&#24182;&#20445;&#23384;&#65292;&#25110;&#32773;&#20445;&#23384;&#24050;&#32463;&#23384;&#22312;&#26631;&#35782;&#31526;&#30340;&#20020;&#26102;&#23454;&#20363;&#30340;&#25913;&#21160;&#12290;<tt class="literal">saveOrUpdate()</tt>&#26041;&#27861;&#23601;&#26159;&#29992;&#26469;&#25552;&#20379;&#36825;&#20010;&#21151;&#33021;&#30340;&#12290;
            
        </p><p>
            Hibernate&#36890;&#36807;&#23545;&#35937;&#30340;&#26631;&#35782;&#31526;&#30340;&#20540;&#65288;&#25110;version,&#25110;timestamp&#26102;&#38388;&#25139;)&#26469;&#20998;&#36776;&#36825;&#26159;&#19968;&#20010;&#8220;&#26032;&#8221;(&#26410;&#20445;&#23384;&#36807;&#30340;&#65289;&#23454;&#20363;&#65292;&#36824;&#26159;&#19968;&#20010;&#8220;&#24050;&#23384;&#22312;&#8221;&#65288;&#24050;&#32463;&#20445;&#23384;&#25110;&#32773;&#20174;&#20808;&#21069;&#30340;session&#20013;&#35013;&#36733;&#30340;&#65289;&#30340;&#23454;&#20363;&#12290;<tt class="literal">id</tt>&#26144;&#23556;&#20013;&#30340;<tt class="literal">unsaved-value</tt>(&#25110;<tt class="literal">&lt;version&gt;</tt>,&#25110; <tt class="literal">&lt;timestamp&gt;</tt>)&#29992;&#26469;&#25351;&#23450;&#21738;&#20010;&#20540;&#34987;&#29992;&#20110;&#34920;&#31034;&#8220;&#26032;&#8221;&#23454;&#20363;&#12290;
        </p><pre class="programlisting">&lt;id name="id" type="long" column="uid" unsaved-value="null"&gt;
    &lt;generator class="hilo"/&gt;
&lt;/id&gt;</pre><p>
            <tt class="literal">unsaved-value</tt>&#20801;&#35768;&#30340;&#21462;&#20540;&#21253;&#25324;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                <tt class="literal">any</tt> - always save &#27704;&#36828;&#20445;&#23384;
                </p></li><li><p>
                <tt class="literal">none</tt> - always update &#27704;&#36828;&#26356;&#26032;
                </p></li><li><p>
                <tt class="literal">null</tt> -  &#24403;&#26631;&#35782;&#31526;&#26159;&#31354;&#30340;&#26102;&#20505;&#20445;&#23384;&#65288;&#40664;&#35748;&#24773;&#20917;&#65289;
                </p></li><li><p>
                valid identifier value (&#21512;&#27861;&#30340;&#26631;&#35782;&#31526;&#20540;)- &#24403;&#26631;&#35782;&#31526;&#26159;null&#25110;&#32773;&#36825;&#20010;&#32473;&#23450;&#30340;&#20540;&#26102;&#20445;&#23384;
                </p></li><li><p>
                <tt class="literal">undefined</tt> - &#23545;&#20110;<tt class="literal">version</tt> &#25110; <tt class="literal">timestamp</tt>&#26469;&#35828;&#30340;&#40664;&#35748;&#20540;&#12290;&#27492;&#26102;&#20351;&#29992;&#26631;&#35782;&#31526;&#26816;&#26597;&#12290;(&#21407;&#25991;: the default for <tt class="literal">version</tt> or <tt class="literal">timestamp</tt>, then identifier check is used.&#21442;&#35265;&#19979;&#25991;&#26377;&#36827;&#19968;&#27493;&#25551;&#36848;.)
                </p></li></ul></div><pre class="programlisting">// in the first session
Cat cat = (Cat) firstSession.load(Cat.class, catID);

// in a higher tier of the application
Cat mate = new Cat();
cat.setMate(mate);

// later, in a new session
secondSession.saveOrUpdate(cat);   // update existing state (cat has a non-null id)
secondSession.saveOrUpdate(mate);  // save the new instance (mate has a null id)</pre><p>
            <tt class="literal">saveOrUpdate()</tt>&#30340;&#29992;&#27861;&#21644;&#35821;&#20041;&#30475;&#26469;&#23545;&#21021;&#23398;&#32773;&#26469;&#35828;&#23481;&#26131;&#36896;&#25104;&#22256;&#24785;&#12290;&#39318;&#20808;&#65292;&#22914;&#26524;&#20320;&#36824;&#27809;&#26377;&#35797;&#22270;&#22312;&#21478;&#19968;&#20010;&#26032;session&#20013;&#20351;&#29992;&#26469;&#33258;&#21407;session&#30340;&#23454;&#20363;&#65292;&#20320;&#26681;&#26412;&#23601;&#19981;&#38656;&#35201;&#20351;&#29992;<tt class="literal">update()</tt>&#25110;&#32773;<tt class="literal">saveOrUpdate()</tt>&#26041;&#27861;&#12290;&#26377;&#19968;&#20123;&#31243;&#24207;&#23436;&#20840;&#19981;&#38656;&#35201;&#20351;&#29992;&#36825;&#20123;&#26041;&#27861;&#12290;
        </p><p>
           	&#36890;&#24120;&#65292;<tt class="literal">update()</tt>&#25110;<tt class="literal">saveorUpdate()</tt>&#26041;&#27861;&#22312;&#19979;&#21015;&#24773;&#24418;&#19979;&#20351;&#29992;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#31243;&#24207;&#22312;&#21069;&#38754;&#30340;session&#20013;&#35013;&#36733;&#20102;&#23545;&#35937;
                </p></li><li><p>
                    &#23545;&#35937;&#34987;&#20256;&#36882;&#21040;UI&#65288;&#30028;&#38754;&#65289;&#23618;
                </p></li><li><p>
                    &#23545;&#35813;&#23545;&#35937;&#36827;&#34892;&#20102;&#19968;&#20123;&#20462;&#25913;
                </p></li><li><p>
                    &#23545;&#35937;&#34987;&#20256;&#36882;&#22238;&#19994;&#21153;&#23618;
                </p></li><li><p>
                    &#24212;&#29992;&#31243;&#24207;&#22312;&#31532;&#20108;&#20010;session&#20013;&#35843;&#29992;<tt class="literal">update()</tt>&#20445;&#23384;&#20462;&#25913;
                </p></li></ul></div><p>
            <tt class="literal">saveOrUpdate()</tt>&#23436;&#25104;&#20102;&#22914;&#19979;&#24037;&#20316;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#22914;&#26524;&#23545;&#35937;&#24050;&#32463;&#22312;&#36825;&#20010;session&#20013;&#25345;&#20037;&#21270;&#36807;&#20102;&#65292;&#20160;&#20040;&#37117;&#19981;&#29992;&#20570;
                </p></li><li><p>
                    &#22914;&#26524;&#23545;&#35937;&#27809;&#26377;&#26631;&#35782;&#20540;&#65292;&#35843;&#29992;<tt class="literal">save()</tt>&#26469;&#20445;&#23384;&#23427;
                </p></li><li><p>
                    &#22914;&#26524;&#23545;&#35937;&#30340;&#26631;&#35782;&#20540;&#19982;<tt class="literal">unsaved-value</tt>&#20013;&#30340;&#26465;&#20214;&#21305;&#37197;&#65292;&#35843;&#29992;<tt class="literal">save()</tt>&#26469;&#20445;&#23384;&#23427;
                </p></li><li><p>
                    &#22914;&#26524;&#23545;&#35937;&#20351;&#29992;&#20102;&#29256;&#26412;(<tt class="literal">version</tt>&#25110;<tt class="literal">timestamp</tt>),&#37027;&#20040;&#38500;&#38750;&#35774;&#32622;<tt class="literal">unsaved-value="undefined"</tt>,&#29256;&#26412;&#26816;&#26597;&#20250;&#21457;&#29983;&#22312;&#26631;&#35782;&#31526;&#26816;&#26597;&#20043;&#21069;.
                </p></li><li><p>
                    &#22914;&#26524;&#36825;&#20010;session&#20013;&#26377;&#21478;&#22806;&#19968;&#20010;&#23545;&#35937;&#20855;&#26377;&#21516;&#26679;&#30340;&#26631;&#35782;&#31526;&#65292;&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;
                </p></li></ul></div></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-update-lock"></a>9.4.3.&nbsp;&#25226;&#19982;Session&#33073;&#31163;&#30340;&#23545;&#35937;&#37325;&#26032;&#32465;&#23450;</h3></div></div><div></div></div><p>
            <tt class="literal">lock()</tt>&#26041;&#27861;&#26159;&#29992;&#26469;&#35753;&#24212;&#29992;&#31243;&#24207;&#25226;&#19968;&#20010;&#26410;&#20462;&#25913;&#30340;&#23545;&#35937;&#37325;&#26032;&#20851;&#32852;&#21040;&#26032;session&#30340;&#26041;&#27861;&#12290;
        </p><pre class="programlisting">//just reassociate: &#30452;&#25509;&#37325;&#26032;&#20851;&#32852;
sess.lock(fritz, LockMode.NONE);
//do a version check, then reassociate:  &#36827;&#34892;&#29256;&#26412;&#26816;&#26597;&#21518;&#20851;&#32852;
sess.lock(izi, LockMode.READ);
//do a version check, using SELECT ... FOR UPDATE, then reassociate: &#20351;&#29992;SELECT ... FOR UPDATE&#36827;&#34892;&#29256;&#26412;&#26816;&#26597;&#21518;&#20851;&#32852;
sess.lock(pk, LockMode.UPGRADE);</pre></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-deleting"></a>9.5.&nbsp;&#21024;&#38500;&#25345;&#20037;&#21270;&#23545;&#35937;</h2></div></div><div></div></div><p>
            &#20351;&#29992;<tt class="literal">Session.delete()</tt>&#20250;&#25226;&#23545;&#35937;&#30340;&#29366;&#24577;&#20174;&#25968;&#25454;&#24211;&#20013;&#31227;&#38500;&#12290;&#24403;&#28982;&#65292;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#21487;&#33021;&#20173;&#28982;&#25345;&#26377;&#19968;&#20010;&#25351;&#21521;&#23427;&#30340;&#24341;&#29992;&#12290;&#25152;&#20197;&#65292;&#26368;&#22909;&#36825;&#26679;&#29702;&#35299;&#65306;<tt class="literal">delete()</tt>&#30340;&#29992;&#36884;&#26159;&#25226;&#19968;&#20010;&#25345;&#20037;&#21270;&#23454;&#20363;&#21464;&#25104;&#20020;&#26102;&#23454;&#20363;&#12290;
        </p><pre class="programlisting">sess.delete(cat);</pre><p>
            &#20320;&#21487;&#20197;&#36890;&#36807;&#20256;&#36882;&#32473;<tt class="literal">delete()</tt>&#19968;&#20010;Hibernate &#26597;&#35810;&#23383;&#31526;&#20018;&#26469;&#19968;&#27425;&#24615;&#21024;&#38500;&#24456;&#22810;&#23545;&#35937;&#12290;
        </p><p>
            &#20320;&#29616;&#22312;&#21487;&#20197;&#29992;&#20320;&#21916;&#27426;&#30340;&#20219;&#20309;&#39034;&#24207;&#21024;&#38500;&#23545;&#35937;&#65292;&#19981;&#29992;&#25285;&#24515;&#22806;&#38190;&#32422;&#26463;&#20914;&#31361;&#12290;&#24403;&#28982;&#65292;&#22914;&#26524;&#20320;&#25630;&#38169;&#20102;&#39034;&#24207;&#65292;&#36824;&#26159;&#26377;&#21487;&#33021;&#24341;&#21457;&#22312;&#22806;&#38190;&#23383;&#27573;&#23450;&#20041;&#30340;<tt class="literal">NOT NULL</tt>&#32422;&#26463;&#20914;&#31361;&#12290;
        </p></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-flushing"></a>9.6.&nbsp;&#21516;&#27493;&#65288;Flush&#65289;</h2></div></div><div></div></div><p>
            &#27599;&#20214;&#38548;&#19968;&#27573;&#26102;&#38388;&#65292;<tt class="literal">Session</tt>&#20250;&#25191;&#34892;&#19968;&#20123;&#24517;&#38656;&#30340;SQL&#35821;&#21477;&#26469;&#25226;&#20869;&#23384;&#20013;&#30340;&#23545;&#35937;&#21644;JDBC&#36830;&#25509;&#20013;&#30340;&#29366;&#24577;&#36827;&#34892;&#21516;&#27493;&#26356;&#26032;&#12290;&#36825;&#20010;&#36807;&#31243;&#34987;&#31216;&#20026;<span class="emphasis"><em>&#21516;&#27493;(flush)</em></span>&#65292;&#40664;&#35748;&#20250;&#22312;&#19979;&#38754;&#30340;&#26102;&#38388;&#28857;&#25191;&#34892;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#22312;&#26576;&#20123;<tt class="literal">find()</tt>&#25110;&#32773;<tt class="literal">iterate()</tt>&#35843;&#29992;&#30340;&#26102;&#20505;
                </p></li><li><p>
                    &#22312;<tt class="literal">net.sf.hibernate.Transaction.commit()</tt>&#30340;&#26102;&#20505;
                </p></li><li><p>
                    &#22312;<tt class="literal">Session.flush()</tt>&#30340;&#26102;&#20505;
                </p></li></ul></div><p>
            &#28041;&#21450;&#30340;SQL&#35821;&#21477;&#20250;&#25353;&#29031;&#19979;&#38754;&#30340;&#39034;&#24207;&#23433;&#25490;&#65306;
        </p><div class="orderedlist"><ol type="1" compact><li><p>
                    &#25152;&#26377;&#23545;&#23454;&#20307;&#36827;&#34892;&#25554;&#20837;&#30340;&#35821;&#21477;&#65292;&#20854;&#39034;&#24207;&#25353;&#29031;&#23545;&#35937;&#25191;&#34892;<tt class="literal">Session.save()</tt>&#30340;&#26102;&#38388;&#39034;&#24207;
                </p></li><li><p>
                    &#25152;&#26377;&#23545;&#23454;&#20307;&#36827;&#34892;&#26356;&#26032;&#30340;&#35821;&#21477;
                </p></li><li><p>
                    &#25152;&#26377;&#36827;&#34892;&#38598;&#21512;&#21024;&#38500;&#30340;&#35821;&#21477;
                </p></li><li><p>
                    &#25152;&#26377;&#23545;&#38598;&#21512;&#20803;&#32032;&#36827;&#34892;&#21024;&#38500;&#65292;&#26356;&#26032;&#25110;&#32773;&#25554;&#20837;&#30340;&#35821;&#21477;
                </p></li><li><p>
                    &#25152;&#26377;&#36827;&#34892;&#38598;&#21512;&#25554;&#20837;&#30340;&#35821;&#21477;
                </p></li><li><p>
                    &#25152;&#26377;&#23545;&#23454;&#20307;&#36827;&#34892;&#21024;&#38500;&#30340;&#35821;&#21477;&#65292;&#20854;&#39034;&#24207;&#25353;&#29031;&#23545;&#35937;&#25191;&#34892;<tt class="literal">Session.delete()</tt>&#30340;&#26102;&#38388;&#39034;&#24207;
                </p></li></ol></div><p>
            &#65288;&#26377;&#19968;&#20010;&#20363;&#22806;&#26102;&#65292;&#22914;&#26524;&#23545;&#35937;&#20351;&#29992;<tt class="literal">native</tt>&#26041;&#24335;&#36827;&#34892; ID &#29983;&#25104;&#30340;&#35805;&#65292;&#23427;&#20204;&#19968;&#25191;&#34892;save&#23601;&#20250;&#34987;&#25554;&#20837;&#12290;&#65289;
        </p><p>
            &#38500;&#38750;&#20320;&#26126;&#30830;&#22320;&#21457;&#20986;&#20102;<tt class="literal">flush()</tt>&#25351;&#20196;&#65292;&#20851;&#20110;Session<span class="emphasis"><em>&#21512;&#26102;</em></span>&#20250;&#25191;&#34892;&#36825;&#20123;JDBC&#35843;&#29992;&#26159;&#23436;&#20840;&#26080;&#27861;&#20445;&#35777;&#30340;&#65292;&#21482;&#33021;&#20445;&#35777;&#23427;&#20204;&#25191;&#34892;&#30340;&#21069;&#21518;&#39034;&#24207;&#12290;&#24403;&#28982;&#65292;Hibernate&#20445;&#35777;&#65292;<tt class="literal">Session.find(..)</tt>&#32477;&#23545;&#19981;&#20250;&#36820;&#22238;&#24050;&#32463;&#22833;&#25928;&#30340;&#25968;&#25454;&#65292;&#20063;&#19981;&#20250;&#36820;&#22238;&#38169;&#35823;&#25968;&#25454;&#12290;
        </p><p>
            &#20063;&#21487;&#20197;&#25913;&#21464;&#40664;&#35748;&#30340;&#35774;&#32622;&#65292;&#26469;&#35753;&#21516;&#27493;&#21457;&#29983;&#30340;&#19981;&#37027;&#20040;&#39057;&#32321;&#12290;<tt class="literal">FlushMode</tt>&#31867;&#23450;&#20041;&#20102;&#19977;&#31181;&#19981;&#21516;&#30340;&#26041;&#24335;&#12290;&#22823;&#37096;&#20998;&#24773;&#20917;&#19979;&#65292;&#23427;&#20204;&#21482;&#30001;&#24403;&#20320;&#22312;&#22788;&#29702;&#8220;&#21482;&#35835;&#8221;&#30340;&#20107;&#21153;&#26102;&#25165;&#20250;&#20351;&#29992;&#65292;&#21487;&#33021;&#20250;&#24471;&#21040;&#19968;&#20123;&#65288;&#19981;&#26159;&#37027;&#20040;&#26126;&#26174;&#30340;&#65289;&#24615;&#33021;&#25552;&#39640;&#12290;
        </p><pre class="programlisting">sess = sf.openSession();
Transaction tx = sess.beginTransaction();
sess.setFlushMode(FlushMode.COMMIT); //allow queries to return stale state
Cat izi = (Cat) sess.load(Cat.class, id);
izi.setName(iznizi);
// execute some queries....
sess.find("from Cat as cat left outer join cat.kittens kitten");
//change to izi is not flushed!
...
tx.commit(); //flush occurs</pre></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-endingsession"></a>9.7.&nbsp;&#32467;&#26463;&#19968;&#20010;Session</h2></div></div><div></div></div><p>
            &#32467;&#26463;&#19968;&#20010;session&#21253;&#25324;&#22235;&#20010;&#29420;&#31435;&#30340;&#27493;&#39588;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#28165;&#27927;session
                </p></li><li><p>
                    &#25552;&#20132;&#20107;&#21153;
                </p></li><li><p>
                    &#20851;&#38381;session
                </p></li><li><p>
                    &#22788;&#29702;&#24322;&#24120;
                </p></li></ul></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-endingsession-flushing"></a>9.7.1.&nbsp;&#21516;&#27493;(Flush) Session</h3></div></div><div></div></div><p>
                &#22914;&#26524;&#20320;&#27491;&#22312;&#20351;&#29992;<tt class="literal">Transaction</tt>API&#65292;&#20320;&#23601;&#19981;&#29992;&#25285;&#24515;&#36825;&#20010;&#27493;&#39588;&#12290;&#22312;&#20107;&#21153;&#25552;&#20132;&#30340;&#26102;&#20505;&#65292;&#38544;&#21547;&#23601;&#20250;&#21253;&#25324;&#36825;&#19968;&#27493;&#12290;&#21542;&#21017;&#65292;&#20320;&#24212;&#35813;&#35843;&#29992;<tt class="literal">Session.flush()</tt>&#26469;&#30830;&#20445;&#20320;&#25152;&#26377;&#30340;&#20462;&#25913;&#37117;&#19982;&#25968;&#25454;&#24211;&#21516;&#27493;&#12290;
            </p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-endingsession-commit"></a>9.7.2.&nbsp;&#25552;&#20132;&#25968;&#25454;&#24211;&#20107;&#21153;</h3></div></div><div></div></div><p>
                &#22914;&#26524;&#20320;&#27491;&#22312;&#20351;&#29992;Hibernate &#30340;<tt class="literal">Transaction</tt> API,&#20195;&#30721;&#31867;&#20284;&#36825;&#26679;&#65306;
            </p><pre class="programlisting">tx.commit(); // flush the Session and commit the transaction</pre><p>
                &#22914;&#26524;&#20320;&#33258;&#34892;&#31649;&#29702;JDBC&#20107;&#21153;&#65292;&#20320;&#24212;&#35813;&#25163;&#24037;&#23545;JDBC &#36830;&#25509;&#25191;&#34892;<tt class="literal">commit()</tt>&#12290;
            </p><pre class="programlisting">sess.flush();
sess.connection().commit();  // not necessary for JTA datasource</pre><p>
                &#22914;&#26524;&#20320;&#20915;&#23450;<span class="emphasis"><em>&#19981;</em></span>&#25552;&#20132;&#20320;&#30340;&#26356;&#25913;&#65306;
            </p><pre class="programlisting">tx.rollback();  // rollback the transaction</pre><p>
                &#25110;&#32773;:
            </p><pre class="programlisting">// not necessary for JTA datasource, important otherwise
sess.connection().rollback();</pre><p>
                &#22914;&#26524;&#20320;&#22238;&#28378;&#20102;&#20107;&#21153;,&#20320;&#24212;&#35813;&#31435;&#21363;&#20851;&#38381;&#21644;&#21462;&#28040;&#24403;&#21069;session,&#30830;&#20445;Hibernate&#20869;&#37096;&#29366;&#24577;&#30340;&#23436;&#25972;&#24615;&#12290;
            </p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-endingsession-close"></a>9.7.3.&nbsp;&#20851;&#38381;Session</h3></div></div><div></div></div><p>
                &#35843;&#29992;<tt class="literal">Session.close()</tt>&#23601;&#26631;&#24535;&#36825;&#20010;session&#36827;&#20837;&#20102;&#23614;&#22768;&#12290;<tt class="literal">close()</tt>&#20027;&#35201;&#30340;&#21547;&#20041;&#23601;&#26159;&#19982;&#36825;&#20010;session&#30456;&#20851;&#30340;JDBC&#36830;&#25509;&#20250;&#34987;&#25918;&#24323;&#12290;
            </p><pre class="programlisting">tx.commit();
sess.close();</pre><pre class="programlisting">sess.flush();
sess.connection().commit();  // not necessary for JTA datasource
sess.close();</pre><p>
                &#22914;&#26524;&#20320;&#33258;&#34892;&#31649;&#29702;&#36830;&#25509;&#65292;<tt class="literal">close()</tt>&#20250;&#36820;&#22238;&#36830;&#25509;&#30340;&#19968;&#20010;&#24341;&#29992;&#65292;&#20320;&#23601;&#21487;&#20197;&#25163;&#24037;&#25226;&#23427;&#20851;&#38381;&#65292;&#25110;&#32773;&#36820;&#22238;&#23427;&#21040;&#36830;&#25509;&#27744;&#21435;&#12290;&#20854;&#20182;&#24773;&#20917;&#19979;&#65292;<tt class="literal">close()</tt>&#20250;&#25226;&#23427;&#36820;&#22238;&#21040;&#36830;&#25509;&#27744;&#21435;&#12290;
            </p></div><div class="sect2" lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a name="manipulatingdata-endingsession-exceptions"></a>9.7.4.&nbsp;&#22788;&#29702;&#24322;&#24120;</h3></div></div><div></div></div><p>
                &#22914;&#26524;<tt class="literal">Session</tt>&#25243;&#20986;&#20102;&#19968;&#20010;exception(&#21253;&#25324;&#20219;&#20309;<tt class="literal">SQLException</tt>),&#20320;&#24212;&#35813;&#31435;&#21051;&#22238;&#28378;&#36825;&#20010;&#20107;&#21153;&#65292;&#35843;&#29992;<tt class="literal">Session.close)()</tt>&#26469;&#21462;&#28040;&#36825;&#20010;<tt class="literal">Session</tt>&#23454;&#20363;&#12290;<tt class="literal">Session</tt>&#20013;&#30340;&#19968;&#20123;&#29305;&#23450;&#26041;&#24335;&#20250;&#30830;&#20445;session<span class="emphasis"><em>&#19981;&#20250;</em></span>&#22788;&#20110;&#19968;&#20010;&#19981;&#31283;&#23450;&#19981;&#23436;&#25972;&#30340;&#29366;&#24577;&#12290;
            </p><p>
                &#24314;&#35758;&#37319;&#29992;&#19979;&#38754;&#30340;&#24322;&#24120;&#22788;&#29702;&#29255;&#26029;&#65306;
            </p><pre class="programlisting">Session sess = factory.openSession();
Transaction tx = null;
try {
    tx = sess.beginTransaction();
    // do some work
    ...
    tx.commit();
}
catch (Exception e) {
    if (tx!=null) tx.rollback();
    throw e;
}
finally {
    sess.close();
}</pre><p>
                &#22914;&#26524;&#20320;&#26159;&#25163;&#24037;&#31649;&#29702;JDBC&#20107;&#21153;&#30340;&#65292;&#29992;&#19979;&#38754;&#36825;&#27573;:
            </p><pre class="programlisting">Session sess = factory.openSession();
try {
    // do some work
    ...
    sess.flush();
    sess.connection().commit();
}
catch (Exception e) {
    sess.connection().rollback();
    throw e;
}
finally {
    sess.close();
}</pre><p>
                &#22914;&#26524;&#20320;&#26159;&#20174;JTA&#20013;&#33719;&#24471;&#25968;&#25454;&#28304;&#30340;&#65306;
            </p><pre class="programlisting">UserTransaction ut = .... ;
Session sess = factory.openSession();
try {
    // do some work
    ...
    sess.flush();
}
catch (Exception e) {
    ut.setRollbackOnly();
    throw e;
}
finally {
    sess.close();
}</pre></div></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-graphs"></a>9.8.&nbsp;&#29983;&#21629;&#21608;&#26399;&#21644;&#23545;&#35937;&#22270;(Lifecyles and object graphs)</h2></div></div><div></div></div><p>
            &#35201;&#20445;&#23384;&#25110;&#32773;&#26356;&#26032;&#19968;&#20010;&#23545;&#35937;&#20851;&#32852;&#22270;&#20013;&#25152;&#26377;&#30340;&#25152;&#26377;&#23545;&#35937;&#65292;&#20320;&#24517;&#39035;&#20570;&#21040;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#20445;&#35777;&#27599;&#19968;&#20010;&#23545;&#35937;&#37117;&#25191;&#34892;<tt class="literal">save()</tt>, <tt class="literal">saveOrUpdate()</tt> &#25110;
                    <tt class="literal">update()</tt>&#26041;&#27861;&#65292;&#25110;&#32773;&#65292;
                    
                </p></li><li><p>
                    &#22312;&#23450;&#20041;&#20851;&#32852;&#23545;&#35937;&#30340;&#26144;&#23556;&#26102;&#65292;&#20351;&#29992;<tt class="literal">cascade="all"</tt>&#25110;<tt class="literal">cascade="save-update"</tt>&#12290;
                </p></li></ul></div><p>
            &#31867;&#20284;&#30340;&#65292;&#35201;&#21024;&#38500;&#19968;&#20010;&#20851;&#31995;&#22270;&#20013;&#30340;&#25152;&#26377;&#23545;&#35937;&#65292;&#24517;&#39035;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#23545;&#27599;&#19968;&#20010;&#23545;&#35937;&#37117;&#25191;&#34892;<tt class="literal">delete()</tt>&#65292;&#25110;&#32773;
                </p></li><li><p>
                    &#22312;&#23450;&#20041;&#20851;&#32852;&#23545;&#35937;&#30340;&#26144;&#23556;&#26102;&#65292;&#20351;&#29992;<tt class="literal">cascade="all"</tt>,<tt class="literal">cascade="all-delete-orphan"</tt>&#25110;<tt class="literal">cascade="delete"</tt>&#12290;
                </p></li></ul></div><p>
            &#24314;&#35758;&#65306;
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#22914;&#26524;&#23376;&#23545;&#35937;&#30340;&#29983;&#21629;&#26399;&#26159;&#32465;&#23450;&#21040;&#29238;&#23545;&#35937;&#30340;&#29983;&#21629;&#26399;&#30340;&#65292;&#36890;&#36807;&#25351;&#23450;<tt class="literal">cascade="all"</tt>&#21487;&#20197;&#25226;&#23427;&#21464;&#25104;&#19968;&#20010;<span class="emphasis"><em>&#33258;&#21160;&#31649;&#29702;&#29983;&#21629;&#21608;&#26399;&#30340;&#23545;&#35937;&#65288;lifecycle object&#65289;</em></span>&#12290;
                </p></li><li><p>
                    &#21542;&#21017;&#65292;&#24517;&#39035;&#22312;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#20013;&#26126;&#30830;&#22320;&#25191;&#34892;<tt class="literal">save()</tt>&#21644;<tt class="literal">delete()</tt>&#12290;&#22914;&#26524;&#20320;&#24819;&#23569;&#25970;&#19968;&#20123;&#20195;&#30721;&#65292;&#21487;&#20197;&#20351;&#29992;<tt class="literal">cascade="sve-update"</tt>&#65292;&#28982;&#21518;&#21482;&#38656;&#26126;&#30830;&#22320;<tt class="literal">delete()</tt>&#12290;
                </p></li></ul></div><p>
            &#23545;&#19968;&#31181;&#20851;&#32852;&#65288;&#22810;&#23545;&#19968;&#65292;&#25110;&#32773;&#38598;&#21512;&#65289;&#20351;&#29992;<tt class="literal">cascade="all"</tt>&#26144;&#23556;&#65292;&#23601;&#25226;&#36825;&#31181;&#20851;&#32852;&#26631;&#35760;&#20026;&#19968;&#31181;<tt class="literal">&#29238;/&#23376;&#65288;parent/child&#65289;</tt>&#39118;&#26684;&#30340;&#20851;&#31995;&#65292;&#23545;&#29238;&#23545;&#35937;&#36827;&#34892;&#20445;&#23384;/&#26356;&#26032;/&#21024;&#38500;&#20250;&#23548;&#33268;&#23545;&#65288;&#25152;&#26377;&#65289;&#23376;&#23545;&#35937;&#30340;&#20445;&#23384;/&#26356;&#26032;/&#21024;&#38500;&#12290;&#20294;&#26159;&#36825;&#20010;&#27604;&#21947;&#24182;&#19981;&#26159;&#29305;&#21035;&#30830;&#20999;&#12290;&#22914;&#26524;&#29238;&#23545;&#35937;&#35299;&#38500;&#20102;&#23545;&#26576;&#20010;&#23376;&#23545;&#35937;&#30340;&#20851;&#32852;&#65292;&#37027;&#36825;&#20010;&#23376;&#23545;&#35937;&#23601;<span class="emphasis"><em>&#19981;&#20250;</em></span>&#34987;&#33258;&#21160;&#21024;&#38500;&#20102;&#12290;&#38500;&#38750;&#36825;&#26159;&#19968;&#20010;<tt class="literal">&#19968;&#23545;&#22810;</tt>&#30340;&#20851;&#32852;&#65292;&#24182;&#19988;&#26631;&#26126;&#20102;<tt class="literal">cascade="all-delete-orphan"&#65288;&#25152;&#26377;-&#21024;&#38500;-&#23396;&#20799;&#65289;</tt>&#12290;&#32423;&#32852;&#25805;&#20316;&#30340;&#31934;&#30830;&#35821;&#20041;&#22312;&#19979;&#38754;&#21015;&#20986;:
        </p><div class="itemizedlist"><ul type="disc" compact><li><p>
                    &#22914;&#26524;&#29238;&#23545;&#35937;&#34987;&#20445;&#23384;&#65292;&#25152;&#26377;&#30340;&#23376;&#23545;&#35937;&#20250;&#34987;&#20256;&#36882;&#21040;<tt class="literal">saveOrUpdate()</tt>&#26041;&#27861;&#21435;&#25191;&#34892;
                </p></li><li><p>
                    &#22914;&#26524;&#29238;&#23545;&#35937;&#34987;&#20256;&#36882;&#21040;<tt class="literal">update()</tt>&#25110;&#32773;<tt class="literal">saveOrUpdate()</tt>&#65292;&#25152;&#26377;&#30340;&#23376;&#23545;&#35937;&#20250;&#34987;&#20256;&#36882;&#21040;<tt class="literal">saveOrUpdate()</tt>&#26041;&#27861;&#21435;&#25191;&#34892;
                </p></li><li><p>
                    &#22914;&#26524;&#19968;&#20010;&#20020;&#26102;&#30340;&#23376;&#23545;&#35937;&#34987;&#19968;&#20010;&#25345;&#20037;&#21270;&#30340;&#29238;&#23545;&#35937;&#24341;&#29992;&#20102;&#65292;&#23427;&#20250;&#34987;&#20256;&#36882;&#21040;<tt class="literal">saveOrUpdate()</tt>&#21435;&#25191;&#34892;
                </p></li><li><p>
                    &#22914;&#26524;&#29238;&#23545;&#35937;&#34987;&#21024;&#38500;&#20102;&#65292;&#25152;&#26377;&#30340;&#23376;&#23545;&#35937;&#23545;&#34987;&#20256;&#36882;&#21040;<tt class="literal">delete()</tt>&#26041;&#27861;&#25191;&#34892;
                </p></li><li><p>
                    &#22914;&#26524;&#20020;&#26102;&#30340;&#23376;&#23545;&#35937;&#19981;&#20877;&#34987;&#25345;&#20037;&#21270;&#30340;&#29238;&#23545;&#35937;&#24341;&#29992;&#65292;<tt class="literal">&#20160;&#20040;&#37117;&#19981;&#20250;&#21457;&#29983;</tt>&#65288;&#24517;&#35201;&#26102;&#65292;&#31243;&#24207;&#24212;&#35813;&#26126;&#30830;&#30340;&#21024;&#38500;&#36825;&#20010;&#23376;&#23545;&#35937;&#65289;&#65292;&#38500;&#38750;&#22768;&#26126;&#20102;<tt class="literal">cascade="all-delete-orphan"</tt>&#65292;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#25104;&#20026;&#8220;&#23396;&#20799;&#8221;&#30340;&#23376;&#23545;&#35937;&#20250;&#34987;&#21024;&#38500;&#12290;
                </p></li></ul></div><p>
            Hibernate&#36824;&#27809;&#26377;&#23436;&#20840;&#23454;&#29616;&#8220;&#36890;&#36807;&#21487;&#35302;&#21450;&#24615;&#20915;&#23450;&#25345;&#20037;&#21270;&#8221;,&#21518;&#32773;&#26263;&#31034;&#20250;&#23545;&#22403;&#22334;&#25910;&#38598;&#36827;&#34892;&#65288;&#25928;&#29575;&#19981;&#39640;&#30340;&#65289;&#25345;&#20037;&#21270;&#12290;&#20294;&#26159;&#65292;&#22240;&#20026;&#24456;&#24191;&#27867;&#30340;&#21628;&#22768;&#65292;Hibernate&#23454;&#29616;&#20102;&#19968;&#31181;&#24847;&#35265;&#65292;&#22914;&#26524;&#19968;&#20010;&#23454;&#20307;&#34987;&#19968;&#20010;&#25345;&#20037;&#21270;&#30340;&#23545;&#35937;&#24341;&#29992;&#65292;&#23427;&#20063;&#20250;&#34987;&#25345;&#20037;&#21270;&#12290;&#27880;&#26126;&#20102;<tt class="literal">cascade="save-update"</tt>&#30340;&#20851;&#32852;&#23601;&#26159;&#25353;&#29031;&#36825;&#31181;&#24605;&#36335;&#36816;&#20316;&#30340;&#12290;&#22914;&#26524;&#20320;&#24076;&#26395;&#22312;&#20320;&#30340;&#25972;&#20010;&#31243;&#24207;&#20013;&#37117;&#36143;&#24443;&#36825;&#20010;&#26041;&#27861;&#65292;&#20320;&#21487;&#20197;&#22312;<tt class="literal">&lt;hibernate-mapping&gt;</tt>&#20803;&#32032;&#30340;<tt class="literal">default-cascade</tt>&#23646;&#24615;&#20013;&#25351;&#23450;&#36825;&#31181;&#32423;&#32852;&#26041;&#24335;&#12290;
        </p></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-interceptors"></a>9.9.&nbsp;&#25318;&#25130;&#22120;(Interceptors)</h2></div></div><div></div></div><p>
            <tt class="literal">Interceptor</tt>&#25509;&#21475;&#25552;&#20379;&#20174;session&#21040;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#30340;&#22238;&#35843;&#26041;&#27861;&#65292;&#35753;&#20320;&#30340;&#31243;&#24207;&#21487;&#20197;&#35266;&#23519;&#21644;&#22312;&#25345;&#20037;&#21270;&#23545;&#35937;&#20445;&#23384;/&#26356;&#25913;/&#21024;&#38500;&#25110;&#32773;&#35013;&#36733;&#30340;&#26102;&#20505;&#25805;&#20316;&#23427;&#30340;&#23646;&#24615;&#12290;&#19968;&#31181;&#21487;&#33021;&#30340;&#29992;&#36884;&#26159;&#29992;&#26469;&#30417;&#35270;&#32479;&#35745;&#20449;&#24687;&#12290;&#27604;&#22914;&#65292;&#19979;&#38754;&#30340;<tt class="literal">Interceptor</tt>&#20250;&#33258;&#21160;&#22312;&#19968;&#20010;<tt class="literal">Auditable</tt>&#21019;&#24314;&#30340;&#26102;&#20505;&#35774;&#32622;&#20854;<tt class="literal">createTimestamp</tt>,&#24182;&#19988;&#24403;&#23427;&#34987;&#26356;&#25913;&#30340;&#26102;&#20505;&#65292;&#35774;&#32622;&#20854;<tt class="literal">lastUpdateTimestamp</tt>&#23646;&#24615;&#12290;
        </p><pre class="programlisting">package net.sf.hibernate.test;

import java.io.Serializable;
import java.util.Date;
import java.util.Iterator;

import net.sf.hibernate.Interceptor;
import net.sf.hibernate.type.Type;

public class AuditInterceptor implements Interceptor, Serializable {

    private int updates;
    private int creates;

    public void onDelete(Object entity,
                         Serializable id,
                         Object[] state,
                         String[] propertyNames,
                         Type[] types) {
        // do nothing
    }

    public boolean onFlushDirty(Object entity, 
                                Serializable id, 
                                Object[] currentState,
                                Object[] previousState,
                                String[] propertyNames,
                                Type[] types) {

        if ( entity instanceof Auditable ) {
            updates++;
            for ( int i=0; i &lt; propertyNames.length; i++ ) {
                if ( "lastUpdateTimestamp".equals( propertyNames[i] ) ) {
                    currentState[i] = new Date();
                    return true;
                }
            }
        }
        return false;
    }

    public boolean onLoad(Object entity, 
                          Serializable id,
                          Object[] state,
                          String[] propertyNames,
                          Type[] types) {
        return false;
    }

    public boolean onSave(Object entity,
                          Serializable id,
                          Object[] state,
                          String[] propertyNames,
                          Type[] types) {
        
        if ( entity instanceof Auditable ) {
            creates++;
            for ( int i=0; i&lt;propertyNames.length; i++ ) {
                if ( "createTimestamp".equals( propertyNames[i] ) ) {
                    state[i] = new Date();
                    return true;
                }
            }
        }
        return false;
    }

    public void postFlush(Iterator entities) {
        System.out.println("Creations: " + creates + ", Updates: " + updates);
    }

    public void preFlush(Iterator entities) {
        updates=0;
        creates=0;
    }
    
    ......
    ......
    
}</pre><p>
            &#24403;session&#34987;&#21019;&#24314;&#30340;&#26102;&#20505;&#65292;&#23601;&#24212;&#35813;&#25351;&#23450;&#25318;&#25130;&#22120;&#12290;
        </p><pre class="programlisting">Session session = sf.openSession( new AuditInterceptor() );</pre></div><div class="sect1" lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manipulatingdata-metadata"></a>9.10.&nbsp;&#20803;&#25968;&#25454;(Metadata) API</h2></div></div><div></div></div><p>
            Hibernate&#23545;&#25152;&#26377;&#30340;&#23454;&#20307;&#21644;&#20540;&#31867;&#22411;&#37117;&#38656;&#35201;&#19968;&#20010;&#38750;&#24120;&#20016;&#23500;&#30340;&#20803;&#32423;&#21035;(meta-level)&#27169;&#22411;&#12290;&#26377;&#26102;&#20505;&#65292;&#36825;&#20010;&#27169;&#22411;&#23545;&#24212;&#29992;&#31243;&#24207;&#26412;&#36523;&#20063;&#20250;&#38750;&#24120;&#26377;&#29992;&#12290;&#27604;&#22914;&#35828;&#65292;&#24212;&#29992;&#31243;&#24207;&#21487;&#33021;&#20351;&#29992;Hibernate&#30340;&#20803;&#25968;&#25454;&#26469;&#23454;&#29616;&#19968;&#31181;&#8220;&#26234;&#33021;&#8221;&#30340;&#28145;&#24230;&#25335;&#36125;&#31639;&#27861;&#65292;&#26469;&#29702;&#35299;&#21738;&#20123;&#23545;&#35937;&#24212;&#35813;&#34987;&#25335;&#36125;&#65288;&#27604;&#22914;&#65292;&#21487;&#21464;&#30340;&#20540;&#31867;&#22411;&#65289;&#65292;&#37027;&#20123;&#19981;&#24212;&#35813;&#65288;&#19981;&#21487;&#21464;&#30340;&#20540;&#31867;&#22411;&#21644;&#21487;&#33021;&#30340;&#34987;&#20851;&#32852;&#30340;&#23454;&#20307;&#65289;&#12290;
        </p><p>
            Hibernate&#36890;&#36807;<tt class="literal">ClassMetadata</tt>&#25509;&#21475;&#65292;<tt class="literal">CollectionMetadata</tt>&#25509;&#21475;&#21644;<tt class="literal">Type</tt>&#23545;&#35937;&#26641;&#65292;&#26292;&#38706;&#20986;&#20803;&#25968;&#25454;&#12290;&#21487;&#20197;&#36890;&#36807;<tt class="literal">SessionFactory</tt>&#33719;&#21462;metadata&#25509;&#21475;&#30340;&#23454;&#20363;&#12290;
        </p><pre class="programlisting">Cat fritz = ......;
Long id = (Long) catMeta.getIdentifier(fritz);
ClassMetadata catMeta = sessionfactory.getClassMetadata(Cat.class);
Object[] propertyValues = catMeta.getPropertyValues(fritz);
String[] propertyNames = catMeta.getPropertyNames();
Type[] propertyTypes = catMeta.getPropertyTypes();
// get a Map of all properties which are not collections or associations
// TODO: what about components?
Map namedValues = new HashMap();
for ( int i=0; i&lt;propertyNames.length; i++ ) {
    if ( !propertyTypes[i].isEntityType() &amp;&amp; !propertyTypes[i].isCollectionType() ) {
        namedValues.put( propertyNames[i], propertyValues[i] );
    }
}</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="inheritance.html">&#19978;&#19968;&#39029;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">&#19978;&#19968;&#32423;</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="transactions.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;8&nbsp;&#31456;&nbsp;&#32487;&#25215;&#26144;&#23556;(Inheritance Mappings)&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;10&nbsp;&#31456;&nbsp;&#20107;&#21153;&#21644;&#24182;&#34892;&#65288;Transactions And Concurrency&#65289;</td></tr></table></div></body></html>